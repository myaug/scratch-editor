<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial Filtering Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .tutorial {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .tutorial.filtered {
            background: #ffebee;
            opacity: 0.6;
        }
        .tutorial.allowed {
            background: #e8f5e8;
        }
        .level-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
            color: white;
        }
        .explorer { background-color: #4C97FF; }
        .creator { background-color: #9966FF; }
        .master { background-color: #FF6B35; }
        .studio { background-color: #FF3355; }
        
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-explorer { background-color: #4C97FF; color: white; }
        .btn-creator { background-color: #9966FF; color: white; }
        .btn-master { background-color: #FF6B35; color: white; }
        .btn-studio { background-color: #FF3355; color: white; }
        
        .current-level {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üéì Tutorial Filtering Test</h1>
    
    <div class="test-section">
        <div class="test-title">Current Level Control</div>
        <div class="current-level" id="currentLevelDisplay">Current Level: Loading...</div>
        <button class="btn-explorer" onclick="setLevel('explorer')">üéØ Explorer</button>
        <button class="btn-creator" onclick="setLevel('creator')">üé® Creator</button>
        <button class="btn-master" onclick="setLevel('master')">‚ö° Master</button>
        <button class="btn-studio" onclick="setLevel('studio')">üèÜ Studio</button>
    </div>

    <div class="test-section">
        <div class="test-title">Tutorial Filtering Results</div>
        <div id="tutorialList">Loading tutorials...</div>
    </div>

    <script type="module">
        // Import the necessary modules
        import { getTutorialLevel, BLOCK_LEVELS, TUTORIAL_LEVEL_MAPPING } from './src/lib/block-levels.js';

        let currentLevel = localStorage.getItem('scratchBlockLevel') || 'explorer';
        
        // Sample tutorials from the actual deck library
        const sampleTutorials = [
            'intro-move-sayhello',
            'add-sprite', 
            'switch-costume',
            'move-around-with-arrow-keys',
            'change-size',
            'glide-around',
            'add-effects',
            'make-it-fly',
            'pong',
            'video-sensing',
            'animate-a-name',
            'Tell-A-Story',
            'Chase-Game',
            'say-it-out-loud'
        ];

        function updateDisplay() {
            // Update current level display
            const levelDisplay = document.getElementById('currentLevelDisplay');
            levelDisplay.textContent = `Current Level: ${currentLevel.toUpperCase()}`;
            levelDisplay.className = `current-level ${currentLevel}`;

            // Update tutorial list
            const tutorialContainer = document.getElementById('tutorialList');
            tutorialContainer.innerHTML = '';

            const levelHierarchy = [BLOCK_LEVELS.EXPLORER, BLOCK_LEVELS.CREATOR, BLOCK_LEVELS.MASTER, BLOCK_LEVELS.STUDIO];
            const currentLevelIndex = levelHierarchy.indexOf(currentLevel);

            sampleTutorials.forEach(tutorialId => {
                const tutorialLevel = getTutorialLevel(tutorialId);
                const tutorialLevelIndex = levelHierarchy.indexOf(tutorialLevel);
                const isAllowed = tutorialLevelIndex <= currentLevelIndex;
                
                const tutorialDiv = document.createElement('div');
                tutorialDiv.className = `tutorial ${isAllowed ? 'allowed' : 'filtered'}`;
                
                tutorialDiv.innerHTML = `
                    <span class="level-indicator ${tutorialLevel}">${tutorialLevel.toUpperCase()}</span>
                    <span>${tutorialId}</span>
                    <span style="margin-left: auto; color: ${isAllowed ? 'green' : 'red'};">
                        ${isAllowed ? '‚úÖ Shown' : '‚ùå Hidden'}
                    </span>
                `;
                
                tutorialContainer.appendChild(tutorialDiv);
            });
        }

        window.setLevel = function(level) {
            currentLevel = level;
            localStorage.setItem('scratchBlockLevel', level);
            updateDisplay();
            
            // Also test if we can trigger a Redux update (if available)
            if (window.__REDUX_STORE__) {
                window.__REDUX_STORE__.dispatch({
                    type: 'scratch-gui/block-level/SET_BLOCK_LEVEL',
                    level: level
                });
                console.log('‚úÖ Redux level updated to:', level);
            } else {
                console.log('‚ö†Ô∏è  Redux store not available for testing');
            }
        };

        // Initial load
        updateDisplay();
        
        console.log('üß™ Tutorial filtering test initialized');
        console.log('üìä Tutorial level mapping:', TUTORIAL_LEVEL_MAPPING);
    </script>
</body>
</html>
